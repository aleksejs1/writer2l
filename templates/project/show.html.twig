{% extends 'project_base.html.twig' %}

{% block title %}Project{% endblock %}

{% block pageTitle %}{{ project.title }} (by {{ project.authorsName }}){% endblock %}

{% block content %}
    {% if chapter is defined and chapter is not null %}
    <div class="table-responsive">
        <table class="table card-table">
            <thead>
            <tr>
                <th class="sort-buttons"></th>
                <th></th>
                <th>Viewpoint</th>
                <th>Words</th>
                <th>Scene</th>
                <th>Status</th>
                <th>A/R</th>
                <th>Letters</th>
                <th>Characters</th>
                <th>Locations</th>
                <th>Items</th>
                <th>Revisions</th>
            </tr>
            </thead>
            <tbody>
            {% for sceneInList in chapter.scenes %}
                <tr {% if scene is defined and scene.id == sceneInList.id %}class="table-primary"{% endif %}>
                    <td class="sort-buttons">
                        <a class="sort-buttons" href="{{ path('scene_position', {'scene': sceneInList.id, 'newPosition': sceneInList.position - 1, 'project': project.id, 'chapter': sceneInList.chapter.id}) }}"><i class="fas fa-chevron-up"></i></a>
                        <a class="sort-buttons" href="{{ path('scene_position', {'scene': sceneInList.id, 'newPosition': sceneInList.position + 1, 'project': project.id, 'chapter': sceneInList.chapter.id}) }}"><i class="fas fa-chevron-down"></i></a>
                    </td>
                    <td><a href="{{ path('scene_edit', {'chapter': chapter.id, 'project': project.id, 'scene': sceneInList.id}) }}"><i class="fas fa-edit"></i></a> {{ sceneInList.note ? 'N' : 'Sc' }}</td>
                    <td>
                        <div class="hidden-overflow" style="max-width: 100px;" title="{{ sceneInList.viewpoint ? sceneInList.viewpoint.shortName : 'N/A' }}">
                            {{ sceneInList.viewpoint ? sceneInList.viewpoint.shortName : 'N/A' }}
                        </div>
                    </td>
                    <td>{{ sceneInList.content|striptags()|split(' ')|length }}</td>
                    <td>
                        <div class="hidden-overflow" style="max-width: 100px;">
                            <a href="{{ path('scene_show', {'project': sceneInList.chapter.project.id, 'chapter': sceneInList.chapter.id, 'scene': sceneInList.id}) }}" title="{{ sceneInList.title ?: '[No title]' }}">{{ sceneInList.title ?: '[No title]' }}</a>
                        </div>
                    </td>
                    <td>{{ constant('App\\Entity\\Scene::STATUS_TITLES')[sceneInList.status] }}</td>
                    <td>{{ constant('App\\Entity\\Scene::GOAL_TITLES')[sceneInList.goalType]|first }}</td>
                    <td>{{ sceneInList.content|striptags()|length }}</td>
                    <td>
                        <div class="hidden-overflow" style="max-width: 100px;">
                            <a href="{{ path('scene_characters', {'project': sceneInList.chapter.project.id, 'chapter': sceneInList.chapter.id, 'scene': sceneInList.id}) }}" title="{% for character in sceneInList.characters %}{{ character.shortname }}{% if not loop.last %}, {% endif %}{% else %}+{% endfor %}">
                                {% for character in sceneInList.characters %}{{ character.shortname }}{% if not loop.last %}, {% endif %}{% else %}<i class="fas fa-plus-circle"></i>{% endfor %}
                            </a>
                        </div>
                    </td>
                    <td>
                        <div class="hidden-overflow" style="max-width: 100px;">
                            <a href="{{ path('scene_locations', {'project': sceneInList.chapter.project.id, 'chapter': sceneInList.chapter.id, 'scene': sceneInList.id}) }}" title="{% for location in sceneInList.locations %}{{ location.title }}{% if not loop.last %}, {% endif %}{% else %}+{% endfor %}">
                                {% for location in sceneInList.locations %}{{ location.title }}{% if not loop.last %}, {% endif %}{% else %}<i class="fas fa-plus-circle"></i>{% endfor %}
                            </a>
                        </div>
                    </td>
                    <td>
                        <div class="hidden-overflow" style="max-width: 100px;">
                            <a href="{{ path('scene_items', {'project': sceneInList.chapter.project.id, 'chapter': sceneInList.chapter.id, 'scene': sceneInList.id}) }}" title="{% for item in sceneInList.items %}{{ item.title }}{% if not loop.last %}, {% endif %}{% else %}+{% endfor %}">
                                {% for item in sceneInList.items %}{{ item.title }}{% if not loop.last %}, {% endif %}{% else %}<i class="fas fa-plus-circle"></i>{% endfor %}
                            </a>
                        </div>
                    </td>
                    <td><a href="{{ path('scene_revision_index', {'project': project.id, 'scene': sceneInList.id}) }}"><i class="fas fa-history"></i></a></td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="11">no records found</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    {% else %}
        <p>Select chapter</p>
    {% endif %}
{% endblock %}
